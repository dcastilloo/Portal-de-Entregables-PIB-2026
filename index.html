<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal A3 BIM Lean</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#111826; --muted:#9aa4b2; --text:#e6eaf0; --line:#1f2a3a;
      --accent:#5eead4;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text);}
    .app{display:grid; grid-template-columns: 340px 1fr; height:100vh;}
    aside{border-right:1px solid var(--line); background:linear-gradient(180deg,var(--panel),#0b0f14);}
    header{padding:14px 14px 10px; border-bottom:1px solid var(--line);}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px;}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--accent); box-shadow:0 0 20px rgba(94,234,212,.35);}
    .sub{color:var(--muted); font-size:12px; margin-top:4px; line-height:1.3;}

    .search{padding:10px 14px; border-bottom:1px solid var(--line);}
    input{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
      background:#0b1220; color:var(--text); outline:none;
    }
    input:focus{border-color:rgba(94,234,212,.55); box-shadow:0 0 0 3px rgba(94,234,212,.12);}

    .list{padding:10px 8px; overflow:auto; height:calc(100vh - 126px);}
    .item{
      display:flex; flex-direction:column; gap:2px;
      padding:10px 10px; margin:4px 6px; border-radius:12px; cursor:pointer;
      border:1px solid transparent;
    }
    .item:hover{background:rgba(255,255,255,.03); border-color:rgba(255,255,255,.05);}
    .item.active{background:rgba(94,234,212,.08); border-color:rgba(94,234,212,.25);}
    .item .t{font-weight:700; font-size:13px;}
    .item .d{color:var(--muted); font-size:12px; line-height:1.25;}
    .item .id{color:rgba(94,234,212,.8); font-size:11px; margin-top:2px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    main{display:flex; flex-direction:column; min-width:0;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px; border-bottom:1px solid var(--line); background:rgba(255,255,255,.02);
    }
    .crumb{color:var(--muted); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .hint{color:var(--muted); font-size:12px;}
    .hint code{color:rgba(94,234,212,.85);}

    .btn{
      padding:8px 10px; border-radius:10px; border:1px solid var(--line);
      background:#0b1220; color:var(--text); cursor:pointer; font-size:12px;
    }
    .btn:hover{border-color:rgba(94,234,212,.35);}
    .btn:active{transform: translateY(1px);}

    iframe{border:0; width:100%; height:100%; background:white; display:block; transform-origin:0 0;}
    .framewrap{flex:1; min-height:0; overflow:auto; background:#ffffff;}
</style>
</head>

<body>
<div class="app">
  <aside>
    <header>
      <div class="brand"><span class="dot"></span> Portal de Entregables PIB 2026</div>
      <div class="sub">Índice + buscador. Cada A3 carga como “página” dentro del visor.</div>
    </header>

    <div class="search">
      <input id="q" type="search" placeholder="Buscar… (ej. CDE, Modelado, AIR, EST-03)" />
    </div>

    <div class="list" id="list"></div>
  </aside>

  <main>
    <div class="topbar">
      <div style="min-width:0;">
        <div class="crumb" id="crumb">Selecciona una página</div>
        <div class="hint">Deep-link interno: <code>#/est1</code>, <code>#/est2</code>, <code>#/est3</code></div>
      </div>
      <div style="display:flex; gap:8px; flex-shrink:0;">
        <button class="btn" id="zoomToggle">Zoom: OFF</button>
        <button class="btn" id="zoomReset">100%</button>
        <button class="btn" id="openNew">Abrir en pestaña</button>
        <button class="btn" id="reload">Recargar</button>
      </div>
    </div>

    <div class="framewrap">
      <iframe id="frame" title="Contenido"></iframe>
    </div>
  </main>
</div>

<script>
  /**
   * IMPORTANTE:
   * - Este index.html debe estar en la MISMA carpeta que tus 3 HTML
   * - Si luego los mueves a /pages/, cambia file: "pages/....html"
   */
  const PAGES = [
    {
      id: "tec3",
      title: "TEC-03 — Aplicativo para administración de licencias",
      desc: "Mejorar el uso de las licencias del CDE",
      file: "A3 BIM Lean_Tec-3_Aplicativo para administración de licencias_VF.html"
    },  
    {
      id: "tec4",
      title: "TEC-04 — Automatizar el modelado 3D de redes",
      desc: "Automatizar el modelado 3D de redes MT/BT aéreas (rural/urbano) ",
      file: "A3 BIM Lean_Tec-4_Automatización Modelado de Redes_VF.html"
    },
    {
      id: "tec5",
      title: "TEC-05 — Dashboard seguimiento de proyectos",
      desc: "Desarrollo de Dashboard para seguimiento de proyectos con el CDE",
      file: "A3 BIM Lean_Tec-5_Dashboard Seguimiento Proyectos_VF.html"
    },
    {
      id: "tec6",
      title: "TEC-06 — Gemelos Digitales en SET",
      desc: "Escalar el Gemelo Digital a las SET con modelos 3d en las empresas del grupo",
      file: "A3 BIM Lean_Tec-6_Gemelos Digitales en SET_VF.html"
    },
    {
      id: "tec7",
      title: "TEC-07 — Integración CDE y GIS",
      desc: "Desarrollo de integración para agilizar la entrega de datos al GIS institucional",
      file: "A3 BIM Lean_Tec-7_Integración CDE y GIS_VF.html"
    },
    {
      id: "tec8",
      title: "TEC-08 — Gestión Inteligente de Proyectos",
      desc: "Desarrollo de Agente IA para la gestión inteligente de proyectos",
      file: "A3 BIM Lean_Tec-8_Gestión Inteligente de Proyectos_VF.html"
    }
  ];

  const listEl = document.getElementById("list");
  const frame = document.getElementById("frame");
  const q = document.getElementById("q");
  const crumb = document.getElementById("crumb");

  // Zoom
  const zoomToggleBtn = document.getElementById("zoomToggle");
  const zoomResetBtn  = document.getElementById("zoomReset");
  let zoomEnabled = false;
  let zoom = 1; // 1 = 100%
  const ZOOM_MIN = 0.5;
  const ZOOM_MAX = 2.5;
  const ZOOM_FACTOR = 1.12; // multiplicador por "tick"

  let current = null;

  function renderList(filterText=""){
    const ft = filterText.trim().toLowerCase();
    const filtered = !ft ? PAGES : PAGES.filter(p =>
      (p.title + " " + p.desc + " " + p.id).toLowerCase().includes(ft)
    );

    listEl.innerHTML = filtered.map(p => `
      <div class="item ${current?.id===p.id ? "active":""}" data-id="${p.id}">
        <div class="t">${p.title}</div>
        <div class="d">${p.desc}</div>
        <div class="id">#/${p.id}</div>
      </div>
    `).join("") || `<div style="padding:12px; color:var(--muted);">Sin resultados.</div>`;

    listEl.querySelectorAll(".item").forEach(el=>{
      el.addEventListener("click", ()=> navigate(el.dataset.id));
    });
  }

  function safeSetHash(id){
    const target = `#/${id}`;
    if (window.location.hash !== target) window.location.hash = target;
  }

  function navigate(id){
    const page = PAGES.find(p => p.id === id) || PAGES[0];
    current = page;

    frame.src = page.file;
    crumb.textContent = `${page.title} — ${page.file}`;

    safeSetHash(page.id);
    renderList(q.value);
  }

  function fromHash(){
    const m = (window.location.hash || "").match(/^#\/(.+)$/);
    const id = m ? m[1] : PAGES[0].id;
    navigate(id);
  }

  q.addEventListener("input", ()=> renderList(q.value));
  window.addEventListener("hashchange", fromHash);

  document.getElementById("reload").addEventListener("click", ()=>{
    frame.src = frame.src;
  });

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function applyZoom(){
    // Truco: ajustar tamaño inverso + scale para que el área "scrolleable" coincida con el zoom
    frame.style.transform = `scale(${zoom})`;
    frame.style.width  = `${100/zoom}%`;
    frame.style.height = `${100/zoom}%`;
    zoomResetBtn.textContent = `${Math.round(zoom*100)}%`;
  }

  function setZoomEnabled(on){
    zoomEnabled = !!on;
    zoomToggleBtn.textContent = `Zoom: ${zoomEnabled ? "ON" : "OFF"}`;
  }

  zoomToggleBtn.addEventListener("click", ()=>{
    setZoomEnabled(!zoomEnabled);
  });

  zoomResetBtn.addEventListener("click", ()=>{
    zoom = 1;
    applyZoom();
  });

  // Zoom con rueda (scroll) sobre el iframe — solo si Zoom está ON
  frame.addEventListener("wheel", (e)=>{
    if(!zoomEnabled) return; // deja el scroll normal
    e.preventDefault();

    const dir = e.deltaY > 0 ? -1 : 1; // rueda arriba = zoom in
    const next = dir > 0 ? zoom * ZOOM_FACTOR : zoom / ZOOM_FACTOR;
    zoom = clamp(next, ZOOM_MIN, ZOOM_MAX);
    applyZoom();
  }, { passive:false });

  // Doble click en el visor = reset zoom
  frame.addEventListener("dblclick", ()=>{ zoom = 1; applyZoom(); });

  document.getElementById("openNew").addEventListener("click", ()=>{
    if(!current) return;
    window.open(current.file, "_blank");
  });

  // Init
  renderList("");
  fromHash();
</script>
</body>
</html>
