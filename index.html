<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal A3 BIM Lean</title>
  <link rel="stylesheet" href="index.css" />
</head>

<body>
<div class="app">
  <aside>
    <header>
      <div class="brand"><span class="dot"></span> Portal de Entregables PIB 2026</div>
      <div class="sub">Índice + buscador. Cada A3 carga como “página” dentro del visor.</div>
    </header>

    <div class="search">
      <input id="q" type="search" placeholder="Buscar… (ej. CDE, Modelado, AIR, EST-03)" />
    </div>

    <div class="list" id="list"></div>
  </aside>

  <main>
    <div class="topbar">
      <div style="min-width:0;">
        <div class="crumb" id="crumb">Selecciona una página</div>
        <div class="hint">Deep-link interno: <code>#/est1</code>, <code>#/est2</code>, <code>#/est3</code></div>
      </div>
      <div style="display:flex; gap:8px; flex-shrink:0;">
        <button class="btn" id="zoomToggle">Zoom: OFF</button>
        <button class="btn" id="zoomReset">100%</button>
        <button class="btn" id="openNew">Abrir en pestaña</button>
        <button class="btn" id="reload">Recargar</button>
      </div>
    </div>

    <div class="framewrap">
      <iframe id="frame" title="Contenido"></iframe>
    </div>
  </main>
</div>

<script>
  /**
   * IMPORTANTE:
   * - Este index.html debe estar en la MISMA carpeta que tus 3 HTML
   * - Si luego los mueves a /pages/, cambia file: "pages/....html"
   */
  const PAGES = [
    {
      id: "per2",
      title: "PER-02 — Capacitación PMI + BIM",
      desc: "Gestión de Proyectos (PMBOK 7 + portafolios + PMO) e introducir BIM aplicado a gestión de la información",
      file: "A3 BIM Lean_Per-2_Capacitación PMI+BIM_VF.html"
    },
    {
      id: "per4",
      title: "PER-04 — Aula Virtual BIM",
      desc: "Formación de personal interno y externo en la ejecución de proyectos BIM",
      file: "A3 BIM Lean_Per-4_Aula virtual BIM_VF.html"
    },
    {
      id: "est5",
      title: "EST-05 — Campaña de difusión de metas y resultados",
      desc: "Diseñar y ejecutar una campaña mixta para difundir metas, avances y resultados BIM ",
      file: "A3 BIM Lean_Est-5_Campaña de difusión de metas y resultados_VF.html"
    },
    {
      id: "est8",
      title: "EST-08 — CONEBIM",
      desc: "3ra edición del evento que posiciona a Distriluz como referente en BIM",
      file: "A3 BIM Lean_Est-8_CONEBIM_VF.html"
    },
    {
      id: "pro4",
      title: "PRO-04 — Actualización de librería de armados",
      desc: "Actualizar la librería de armados con calidad y estandarización",
      file: "A3 BIM Lean_Pro-4_Actualización de librería de armados_VF.html"
    },
    {
      id: "tec3",
      title: "TEC-03 — Aplicativo para administración de licencias",
      desc: "Mejorar el uso de las licencias del CDE",
      file: "A3 BIM Lean_Tec-3_Aplicativo para administración de licencias_VF.html"
    },  
    {
      id: "tec4",
      title: "TEC-04 — Automatizar el modelado 3D de redes",
      desc: "Automatizar el modelado 3D de redes MT/BT aéreas (rural/urbano) ",
      file: "A3 BIM Lean_Tec-4_Automatización Modelado de Redes_VF.html"
    },
    {
      id: "tec5",
      title: "TEC-05 — Dashboard seguimiento de proyectos",
      desc: "Desarrollo de Dashboard para seguimiento de proyectos con el CDE",
      file: "A3 BIM Lean_Tec-5_Dashboard Seguimiento Proyectos_VF.html"
    },
    {
      id: "tec6",
      title: "TEC-06 — Gemelos digitales en SET",
      desc: "Escalar piloto de gemelo digital a todas las SET con modelos 3d",
      file: "A3 BIM Lean_Tec-6_Gemelos Digitales en SET_VF.html"
    },
    {
      id: "tec7",
      title: "TEC-07 — Integración CDE y GIS",
      desc: "Desarrollo de integración para agilizar la entrega de datos al GIS institucional",
      file: "A3 BIM Lean_Tec-7_Integración CDE y GIS_VF.html"
    },
    {
      id: "tec8",
      title: "TEC-08 — Gestión Inteligente de Proyectos",
      desc: "Desarrollo de Agente IA para la gestión inteligente de proyectos",
      file: "A3 BIM Lean_Tec-8_Gestión Inteligente de Proyectos_VF.html"
    },
    {
    id: "gantt",
    title: "Gantt — PIB 2026",
    desc: "Cronograma (semanal/mensual) con filtros y línea de hoy",
    file: "gantt.html"
    }
  ];

  const listEl = document.getElementById("list");
  const frame = document.getElementById("frame");
  const q = document.getElementById("q");
  const crumb = document.getElementById("crumb");

  // Zoom
  const zoomToggleBtn = document.getElementById("zoomToggle");
  const zoomResetBtn  = document.getElementById("zoomReset");
  let zoomEnabled = false;
  let zoom = 1; // 1 = 100%
  const ZOOM_MIN = 0.5;
  const ZOOM_MAX = 2.5;
  const ZOOM_FACTOR = 1.12; // multiplicador por "tick"

  let current = null;

  function renderList(filterText=""){
    const ft = filterText.trim().toLowerCase();
    const filtered = !ft ? PAGES : PAGES.filter(p =>
      (p.title + " " + p.desc + " " + p.id).toLowerCase().includes(ft)
    );

    listEl.innerHTML = filtered.map(p => `
      <div class="item ${current?.id===p.id ? "active":""}" data-id="${p.id}">
        <div class="t">${p.title}</div>
        <div class="d">${p.desc}</div>
        <div class="id">#/${p.id}</div>
      </div>
    `).join("") || `<div style="padding:12px; color:var(--muted);">Sin resultados.</div>`;

    listEl.querySelectorAll(".item").forEach(el=>{
      el.addEventListener("click", ()=> navigate(el.dataset.id));
    });
  }

  function safeSetHash(id){
    const target = `#/${id}`;
    if (window.location.hash !== target) window.location.hash = target;
  }

  function navigate(id){
    const page = PAGES.find(p => p.id === id) || PAGES[0];
    current = page;

    frame.src = page.file;
    crumb.textContent = `${page.title} — ${page.file}`;

    safeSetHash(page.id);
    renderList(q.value);
  }

  function fromHash(){
    const m = (window.location.hash || "").match(/^#\/(.+)$/);
    const id = m ? m[1] : PAGES[0].id;
    navigate(id);
  }

  q.addEventListener("input", ()=> renderList(q.value));
  window.addEventListener("hashchange", fromHash);

  document.getElementById("reload").addEventListener("click", ()=>{
    frame.src = frame.src;
  });

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function applyZoom(){
    // Truco: ajustar tamaño inverso + scale para que el área "scrolleable" coincida con el zoom
    frame.style.transform = `scale(${zoom})`;
    frame.style.width  = `${100/zoom}%`;
    frame.style.height = `${100/zoom}%`;
    zoomResetBtn.textContent = `${Math.round(zoom*100)}%`;
  }

  function setZoomEnabled(on){
    zoomEnabled = !!on;
    zoomToggleBtn.textContent = `Zoom: ${zoomEnabled ? "ON" : "OFF"}`;
  }

  zoomToggleBtn.addEventListener("click", ()=>{
    setZoomEnabled(!zoomEnabled);
  });

  zoomResetBtn.addEventListener("click", ()=>{
    zoom = 1;
    applyZoom();
  });

  // Zoom con rueda (scroll) sobre el iframe — solo si Zoom está ON
  frame.addEventListener("wheel", (e)=>{
    if(!zoomEnabled) return; // deja el scroll normal
    e.preventDefault();

    const dir = e.deltaY > 0 ? -1 : 1; // rueda arriba = zoom in
    const next = dir > 0 ? zoom * ZOOM_FACTOR : zoom / ZOOM_FACTOR;
    zoom = clamp(next, ZOOM_MIN, ZOOM_MAX);
    applyZoom();
  }, { passive:false });

  // Doble click en el visor = reset zoom
  frame.addEventListener("dblclick", ()=>{ zoom = 1; applyZoom(); });

  document.getElementById("openNew").addEventListener("click", ()=>{
    if(!current) return;
    window.open(current.file, "_blank");
  });

  // Init
  renderList("");
  fromHash();
</script>
</body>
</html>
